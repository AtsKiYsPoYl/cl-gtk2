<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>CL-GTK2 Tutorial</title><meta name="generator" content="DocBook XSL Stylesheets V1.75.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" title="CL-GTK2 Tutorial"><div class="titlepage"><div><div><h2 class="title"><a name="id256750"></a>CL-GTK2 Tutorial</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Dmitry</span> <span class="surname">Kalyanov</span></h3><code class="email">&lt;<a class="email" href="mailto:Kalyanov.Dmitry@gmail.com">Kalyanov.Dmitry@gmail.com</a>&gt;</code></div></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#id466095">TODO</a></span></dt><dt><span class="section"><a href="#id466114">Installation</a></span></dt><dt><span class="section"><a href="#id466249">"Hello world" example</a></span></dt><dt><span class="section"><a href="#id466326">Example walk-through</a></span></dt></dl></div><div class="section" title="TODO"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id466095"></a>TODO</h2></div></div></div><p>Introduction</p><p>More involved example: simple text editor</p><p>More involved example walk-through: widgets, properties, packing, child properties</p><p>TreeView example</p></div><div class="section" title="Installation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id466114"></a>Installation</h2></div></div></div><p>CL-GTK2 is in alpha stage and is unstable and not feature-complete. It is being developed on x86-64 gentoo linux with SBCL. It should, in general, work with other lisp compilers and on other platforms. CL-GTK2 requires some features not present in the Common Lisp Standard, namely it requires CFFI support with callbacks and long-long support (most modern lisp implementations are supported, including clisp) and it requires CLOS MOP (MetaObject Protocol) which is also is present (or is being added to) most modern lisp implementations.</p><p>CL-GTK2 requires Gtk+ version 2.16 or later. CL-GTK2 was tested on SBCL-1.0.18 and SBCL-1.0.28</p><p>If you have any difficulties installing or using CL-GTK2, contact me (the author of this tutorial and of CL-GTK2) via email Kalyanov.Dmitry@gmail.com or via jabber mo3r@jabber.ru.</p><p>First, install CL-GTK2 dependcies. CL-GTK2 has the following dependencies (CL-GTK2 was tested with specified versions; it would probably not work with earlier versions but should work with later versions):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="ulink" href="http://common-lisp.net/project/cffi" target="_top">CFFI</a> (version 0.10.4)</p></li><li class="listitem"><p><a class="ulink" href="http://www.cliki.net/trivial-garbage" target="_top">Trivial-Garbage</a> (version 0.18)</p></li><li class="listitem"><p><a class="ulink" href="http://common-lisp.net/project/iterate/" target="_top">Iterate</a> (version 1.4.3)</p></li><li class="listitem"><p><a class="ulink" href="http://common-lisp.net/project/bordeaux-threads/" target="_top">Bordeaux-Threads</a> (version 0.6.0)</p></li><li class="listitem"><p><a class="ulink" href="http:/common-lisp.net/project/closer/closer-mop.html/" target="_top">Closer-MOP</a> (version 0.55)</p></li></ul></div><p>Currently, CL-GTK2 is only available in Git repository at <a class="ulink" href="http://repo.or.cz/w/cl-gtk2.git" target="_top">http://repo.or.cz/w/cl-gtk2.git</a>. If you do not want or can not to use Git, download the snapshot from <a class="ulink" href="http://repo.or.cz/w/cl-gtk2.git?a=snapshot;h=HEAD;sf=tgz" target="_top">http://repo.or.cz/w/cl-gtk2.git?a=snapshot;h=HEAD;sf=tgz</a>.</p><p>Unpack the CL-GTK2 sources, and add them to <code class="varname">asdf:*central-registry*</code>:</p><pre class="programlisting">
      (push "/path/to/cl-gtk2/glib/" asdf:*central-registry*)
      (push "/path/to/cl-gtk2/gdk/" asdf:*central-registry*)
      (push "/path/to/cl-gtk2/gtk/" asdf:*central-registry*)
    </pre><p>Now you should be able to load the CL-GTK2:</p><pre class="programlisting">(asdf:oos 'asdf:load-op :gtk)</pre><p>When the system is loaded, run <code class="varname">(gtk-demo:demo-text-editor)</code>. A text editor window should pop up:</p><div><img src="lisp_ide.png"></div><p>This is a very simple text editor written in CL-GTK2. Apart from editing the text, it can evaluate expressions: select expression and press the "execute" button. Expression will be evaluated and its result will be put into text view.</p></div><div class="section" title='"Hello world" example'><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id466249"></a>"Hello world" example</h2></div></div></div><p>Let's start from a simple example.</p><div><img src="hello_world.png"></div><p>Start Slime, type the following code in the REPL:</p><pre class="programlisting">
(asdf:oos 'asdf:load-op :gtk)

(gtk:within-main-loop
  (let ((window (make-instance 'gtk:gtk-window :title "Hello, world!")))
    (gtk:widget-show window)))
    </pre><p>The empty window with title "Hello, world!" should appear.</p><p>Let's analyze this example line-by-line.</p><p><code class="varname">(asdf:oos 'asdf:load-op :gtk)</code> loads the GTK system into Lisp.</p><p>CL-GTK2 runs Gtk+ main loop in background thread (because Lisp development is interactive in its nature; if main loop would block the REPL thread, you would have to restart the Lisp image too often). Because all access to Gtk+ should come from Gtk+ thread, we should run the code in that thread. Macro <code class="varname">gtk:within-main-loop</code> does exactly that: it schedules the code to be tun in the Gtk+ thread. You should use this macro whenever you want evaluate the code from the REPL or when you start you application.</p><p>Next, we create the window with <code class="varname">make-instance</code> and set its <code class="varname">title</code> property to <code class="varname">"Hello, world!"</code>.</p><p>When the window is created, it is not yet shown on the screen. To show it, we call <code class="varname">(gtk:widget-show window)</code>.</p><p>After this code executes, you should get back to the REPL (rememer, Gtk+ runs in background thread) and the window should appear on the screen.</p></div><div class="section" title="Example walk-through"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id466326"></a>Example walk-through</h2></div></div></div><p>Let's analyze the example step by step.</p><p>CL-GTK2 runs the Gtk main loop in background thread. This is done so you could have your application running and interacting with the Lisp system through the REPL.</p><p>To execute some code and ensure that Gtk+ main loop is started, WITH-MAIN-LOOP macro is used. It runs the body of code within the Gtk+ main loop. Because all calls to Gtk+ functions require locking, it is neccessary to run this code from th main loop. Because we are running the code in another thread, its dynamic bindings (including *standard-output*) will be lost. To be able to print at REPL, we save reference to the standard output stream in the closure.</p><p>Gtk+ objects are created with make-instance and are properly garbage-collected.</p><p>Object have properties, which are represented as slots in CL-GTK2. Some properties (slots) of objects are constructor-only properties and can only be set at object construction time. For example, "type" property of GtkWindow can only be set during its creation. To access properties, you may use <code class="varname">slot-value</code> function or slot accessor methods. For property <code class="varname">Y</code> declared on class <code class="varname">X</code>, method <code class="varname">X-Y</code> returns the value of the property. Properties are setfable (with exception of read-only and constructor-only properties).</p><p>Call to container-add puts button as a child widget into window, and widget-show shows all widgets of window.</p><p>In Gtk+, objects have "signals", to which handlers can be attached. When something happens that results in "emitting" the signal (e.g., button being clicked emits "clicked" signal), all handlers of this signal are called. Handler of GtkButton's "clicked" signal has only one argument - the button that was clicked. CL-GTK2 allows attaching any function (including closures) as signal handlers and ensures that closure is freed properly.</p></div></div></body></html>
